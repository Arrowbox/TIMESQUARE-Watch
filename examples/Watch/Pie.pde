PROGMEM uint8_t
 wedge[] = {
  0x08,0x04,0x00,0x00,0x3A,0x04,0x00,0x00,0x9F,0x04,0x00,0x00,0xF5,0x0B,0x00,0x00,
  0xF5,0x36,0x00,0x00,0xF0,0x72,0x00,0x00,0xF5,0x87,0x03,0x00,0xF5,0x87,0x06,0x00,
  0xF5,0x87,0x06,0x00,0xF3,0x84,0x05,0x00,0xF0,0x81,0x05,0x00,0xEB,0x82,0x06,0x00,
  0xFA,0x87,0x06,0x00,0xFA,0x87,0x07,0x00,0xF8,0x87,0x06,0x00,0xF5,0x87,0x06,0x00,
  0x08,0x08,0x07,0x00,0x27,0x08,0x07,0x00,0x61,0x08,0x07,0x00,0xBF,0x08,0x07,0x00,
  0xFF,0x16,0x07,0x00,0xFF,0x4D,0x07,0x00,0xFF,0xB8,0x0A,0x00,0xFF,0xFD,0x2A,0x00,
  0xFF,0xFF,0x8D,0x00,0xFF,0xFF,0xE0,0x01,0xFF,0xFF,0xE7,0x05,0xFF,0xFF,0xEE,0x06,
  0xFF,0xFF,0xEB,0x06,0xFF,0xFF,0xEE,0x06,0xFF,0xFF,0xE9,0x06,0xFF,0xFF,0xEE,0x06,
  0x08,0x08,0x08,0x04,0x19,0x08,0x08,0x04,0x31,0x08,0x08,0x04,0x57,0x08,0x08,0x04,
  0x8D,0x08,0x08,0x04,0xCC,0x0A,0x08,0x04,0xF3,0x17,0x08,0x04,0xFF,0x3C,0x08,0x04,
  0xFF,0x86,0x0A,0x04,0xFF,0xD0,0x21,0x04,0xFF,0xFD,0x6B,0x08,0xFF,0xFF,0xD7,0x26,
  0xFF,0xFF,0xFF,0x6C,0xFF,0xFF,0xFF,0x87,0xFF,0xFF,0xFF,0x82,0xFF,0xFF,0xFF,0x87,
  0x08,0x08,0x08,0x08,0x0F,0x08,0x08,0x08,0x14,0x08,0x08,0x08,0x1A,0x08,0x08,0x08,
  0x24,0x08,0x08,0x08,0x2E,0x08,0x08,0x08,0x3C,0x08,0x08,0x08,0x51,0x08,0x08,0x08,
  0x6E,0x09,0x08,0x08,0x86,0x0D,0x08,0x08,0x9B,0x19,0x08,0x08,0xB2,0x35,0x09,0x08,
  0xCC,0x5D,0x1E,0x08,0xE0,0x8E,0x51,0x24,0xF5,0xCC,0xA3,0x71,0xFF,0xFF,0xFF,0xF5 },
 digits12[12][6] = { 
  { B00000000,
    B10110000,
    B10010000,
    B10100000,
    B10110000,
    B00000000 },
  { B01100000,
    B00100000,
    B00100000,
    B00100000,
    B00100000,
    B00100000 },
  { B01100000,
    B10010000,
    B00010000,
    B01100000,
    B10000000,
    B11110000 },
  { B11100000,
    B00010000,
    B01100000,
    B00010000,
    B10010000,
    B01100000 },
  { B10000000,
    B10100000,
    B10100000,
    B11110000,
    B00100000,
    B00100000 },
  { B11110000,
    B10000000,
    B11100000,
    B00010000,
    B10010000,
    B01100000 },
  { B01100000,
    B10000000,
    B11100000,
    B10010000,
    B10010000,
    B01100000 },
  { B11110000,
    B00010000,
    B00100000,
    B00100000,
    B01000000,
    B01000000 },
  { B01100000,
    B10010000,
    B01100000,
    B10010000,
    B10010000,
    B01100000 },
  { B01100000,
    B10010000,
    B10010000,
    B01110000,
    B00010000,
    B01100000 },
  { B00000000,
    B10111000,
    B10101000,
    B10101000,
    B10111000,
    B00000000 },
  { B00000000,
    B10010000,
    B10010000,
    B10010000,
    B10010000,
    B00000000 } },
 digits24[24][5] = {
  { B00000000,
    B11111100,
    B10110100,
    B10110100,
    B11111100 },
  { B00000000,
    B11101000,
    B10101000,
    B10101000,
    B11101000 },
  { B00000000,
    B11101100,
    B10100100,
    B10101000,
    B11101100 },
  { B00001100,
    B11100100,
    B10101100,
    B10100100,
    B11101100 },
  { B00000000,
    B11101000,
    B10101000,
    B10101100,
    B11100100 },
  { B00000000,
    B11101100,
    B10101000,
    B10100100,
    B11101100 },
  { B00000000,
    B11101100,
    B10101000,
    B10101100,
    B11101100 },
  { B00000000,
    B11101100,
    B10100100,
    B10100100,
    B11100100 },
  { B00000000,
    B11101100,
    B10101100,
    B10101100,
    B11101100 },
  { B00000000,
    B11101100,
    B10101100,
    B10100100,
    B11101100 },
  { B00000000,
    B01011100,
    B01010100,
    B01010100,
    B01011100 },
  { B00000000,
    B01001000,
    B01001000,
    B01001000,
    B01001000 },
  { B00000000,
    B01011000,
    B01001000,
    B01010000,
    B01011000 },
  { B00011000,
    B01001000,
    B01011000,
    B01001000,
    B01011000 },
  { B00000000,
    B01010000,
    B01010000,
    B01011000,
    B01001000 },
  { B00000000,
    B01011000,
    B01010000,
    B01001000,
    B01011000 },
  { B00000000,
    B01011000,
    B01010000,
    B01011000,
    B01011000 },
  { B00000000,
    B01011000,
    B01001000,
    B01001000,
    B01001000 },
  { B00000000,
    B01011000,
    B01011000,
    B01011000,
    B01011000 },
  { B00000000,
    B01011000,
    B01011000,
    B01001000,
    B01011000 },
  { B00000000,
    B11011100,
    B01010100,
    B10010100,
    B11011100 },
  { B00000000,
    B01101000,
    B00101000,
    B01001000,
    B01101000 },
  { B00000000,
    B11011000,
    B01001000,
    B10010000,
    B11011000 },
  { B00011000,
    B11001000,
    B01011000,
    B10001000,
    B11011000 } };

void mode_pie(uint8_t action) {
  DateTime now;
  uint8_t  h, m, i, q, w, b;
  uint16_t t;

  // Reset sleep timeout on any button action, even
  // if it has no consequences in the current mode.
  if(action != ACTION_NONE) watch.setTimeout(WATCH_FPS * 3);

  now = RTC.now();
  h   = now.hour();
  m   = now.minute();

  watch.fillScreen(BACKGROUND);
  b = ((t = watch.getTimeout()) < sizeof(fade)) ? (uint8_t)pgm_read_byte(&fade[t]) : 255;
  for(i=1, q=0; i<=4; i++, q += 15) {
    if(m <= q)             w = 0;
    else if(m >= (q + 15)) w = 15;
    else                   w = m - q;
    blit(wedge, 64, 4, w * 4, 0, 4, 0, 4, 4, b);
    watch.setRotation(i & 3);
  }

  if(h24) {
    watch.drawBitmap(1, 1, digits24[h], 6, 5, 0);
  } else {
    if(h >= 12) h -= 12;
    watch.drawBitmap(2, 1, digits12[h], 5, 6, 0);
  }
}

